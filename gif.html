<!DOCTYPE html>
  <html>
    <head>
      <title>ChessT Play</title>
      <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css"  media="screen,projection"/>
      <link type="text/css" rel="stylesheet" href="css/chessboard-0.3.0.css"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>

    <body>
      <script src="js/chess.js"></script>
      <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
      <script type="text/javascript" src="js/bootstrap.min.js"></script>
      <script type="text/javascript" src="js/chessboard-0.3.0.js"></script>
      <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script> 
      <script type="text/javascript" src="js/jquery-ui-1.8.24.custom.min.js"></script> 
      <script type="text/javascript" src="js/html2canvas.js"></script>
      <script type="text/javascript" src="js/base64.js"></script>
      <script type="text/javascript" src="js/canvas2image.js"></script>
      <script type="text/javascript" src="js/gif.js"></script>
      <script type="text/javascript">

        function change(page){
          $('body').fadeOut();
          setTimeout(changeDelay, 500, page);
        }

        function changeDelay(page){
          window.location.href = page;
        }

      </script>

      <style type="text/css">

      @font-face {
        font-family: 'Poiret One';
        src: url('img/PoiretOne-Regular.ttf');
        }

      body{
        font-family: Poiret One;
      }

      </style>

      <!--NAVBAR-->
      <nav class="navbar navbar-default">
        <div class="navbar-header" style="width:100%;">
          <a class="navbar-brand " onclick="change('index.html')"><span class="glyphicon glyphicon-chevron-left"></span></a>
          <span class="navbar-brand " style="float:right;">ChessT</span>
        </div>
      </nav>

      <div id="board" style="margin:auto;"></div>
      <h3 style="text-align:center;">Status: <span id="status"></span></h3>


      <div class="container">
        <div class="span2">
          <input type="button" id="gifBtn" class="btn btn-primary btn-block" value="Go" onclick="gifgo()" />
        </div>
      </div>

      <canvas id="can"></canvas>

      <div id="img-out"></div>


      <script type="text/javascript">



          var board,
            game = new Chess(),
            statusEl = $('#status'),
            fenEl = $('#fen'),
            pgnEl = $('#pgn');

            var arr =[];

          // do not pick up pieces if the game is over
          // only pick up pieces for the side to move
          var onDragStart = function(source, piece, position, orientation) {
            if (game.game_over() === true ||
                (game.turn() === 'w' && piece.search(/^b/) !== -1) ||
                (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
              return false;
            }
          };

          var onDrop = function(source, target) {
            // see if the move is legal
            var move = game.move({
              from: source,
              to: target,
              promotion: 'q' // NOTE: always promote to a queen for example simplicity
            });

            // illegal move
            if (move === null) return 'snapback';

            updateStatus();
          };

          // update the board position after the piece snap 
          // for castling, en passant, pawn promotion
          var onSnapEnd = function() {
            board.position(game.fen());
          };

          var updateStatus = function() {
            var status = '';

            var moveColor = 'White';
            if (game.turn() === 'b') {
              moveColor = 'Black';
            }

            // checkmate?
            if (game.in_checkmate() === true) {
              status = 'Game over, ' + moveColor + ' is in checkmate.';
            }

            // draw?
            else if (game.in_draw() === true) {
              status = 'Game over, drawn position';
            }

            // game still on
            else {
              arr.push(board.position('fen'));
              console.log(arr);
              status = moveColor + ' to move';

              // check?
              if (game.in_check() === true) {
                status += ', ' + moveColor + ' is in check';
              }
            }

            statusEl.html(status);
            fenEl.html(game.fen());
            pgnEl.html(game.pgn());
          };

          var cfg = {
            draggable: true,
            position: 'start',
            onDragStart: onDragStart,
            onDrop: onDrop,
            onSnapEnd: onSnapEnd
          };


        if(screen.width < screen.height){$("#board").css("width","90%");}
            else{$("#board").css("width","30%");}
            board = ChessBoard('board', cfg);
            updateStatus();

            function f(color){
              board.orientation(color);
            }  

        function gifgo(){

          arr.push(board.position('fen'));

          for (i = 1; i < arr.length; i++) { 
              console.log(i);
              setTimeout(ch, i*1000, i);
          }
          //setTimeout(f, arr.length*1000 + 500);
        }
          


        function ch(i){
          console.log("e");
          console.log(arr[i])
          
          html2canvas($("#board"), {
              onrendered: function(canvas) {
                theCanvas = canvas;
                document.body.appendChild(canvas);

                // Convert and download as image 
                $("#img-out").append(canvas);

                  gif.addFrame(canvas, {delay: 200});


                // Clean up 
                //document.body.removeChild(canvas);
            }
        });
          board.position(arr[i],false);

          }



        

/*
          $(function() { 
            $("#gifBtn").click(function() { 
              html2canvas($("#board"), {
              onrendered: function(canvas) {
                theCanvas = canvas;
                document.body.appendChild(canvas);

                // Convert and download as image 
                $("#img-out").append(canvas);
                // Clean up 
                //document.body.removeChild(canvas);
            }
        });
    });
}); 

*/
        

      </script>
    </body>
  </html>